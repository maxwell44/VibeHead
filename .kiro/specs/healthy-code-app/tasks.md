# 实施计划

- [x] 1. 建立项目基础架构和核心数据模型
  - 创建iOS项目，配置MVVM架构基础
  - 实现核心数据模型：PostureType、PomodoroSession、PostureRecord、AppSettings
  - 配置项目依赖和权限设置（摄像头权限）
  - _需求: 1.1, 1.2, 5.1_

- [x] 2. 实现番茄时钟核心功能
  - [x] 2.1 创建PomodoroService和相关协议
    - 编写PomodoroServiceProtocol接口定义
    - 实现PomodoroService类，包含计时器逻辑和状态管理
    - 添加开始、暂停、重置、完成会话的方法
    - _需求: 1.1, 1.4, 1.5_

  - [x] 2.2 实现计时器UI组件
    - 创建CircularProgressView SwiftUI组件显示倒计时
    - 实现大字体时间显示和进度指示器
    - 添加开始/暂停/重置按钮的UI和交互
    - _需求: 1.3, 4.1, 4.2_

  - [x] 2.3 添加音频和触觉反馈
    - 集成AVAudioPlayer实现计时器完成音频提醒
    - 使用Core Haptics添加触觉反馈
    - 实现设置中的提醒开关控制
    - _需求: 1.5, 1.6_

- [-] 3. 实现摄像头和体态检测功能
  - [x] 3.1 建立摄像头捕获系统
    - 使用AVFoundation创建AVCaptureSession
    - 实现前置摄像头预览功能
    - 添加摄像头权限请求和处理逻辑
    - _需求: 2.1, 5.1, 5.2_

  - [x] 3.2 集成Vision Framework面部检测
    - 实现PostureDetectionService类和协议
    - 使用VNDetectFaceRectanglesRequest进行面部检测
    - 创建面部观察数据的实时处理管道
    - _需求: 2.2, 6.3, 6.4_

  - [x] 3.3 实现体态分类算法
    - 编写面部角度分析逻辑（pitch、roll、yaw）
    - 实现四种体态状态的判断：优雅、低头、歪头、太近
    - 添加体态状态变化的实时检测和记录
    - _需求: 2.3, 2.4, 2.5, 2.6_

  - [x] 3.4 添加体态警告和反馈系统
    - 实现不良体态持续时间监控（10秒阈值）
    - 添加触觉和音频提醒功能
    - 创建体态状态的UI显示组件
    - _需求: 2.7, 4.3_

- [x] 4. 实现数据统计和持久化
  - [x] 4.1 创建本地数据存储系统
    - 实现LocalDataRepository使用UserDefaults
    - 编写会话数据的保存和读取逻辑
    - 添加数据清理功能（30天限制）
    - _需求: 3.7, 5.4, 5.5_

  - [x] 4.2 实现统计计算服务
    - 创建StatisticsService计算健康分数
    - 实现体态时间分解和百分比计算
    - 添加会话历史数据的聚合分析
    - _需求: 3.1, 3.2, 3.4_

  - [x] 4.3 开发统计界面UI
    - 创建StatisticsView显示会话总结
    - 实现健康分数的大字体显示和颜色指示器
    - 添加体态时间的水平进度条组件
    - _需求: 3.5, 3.6, 4.5_

- [x] 5. 实现主工作界面集成
  - [x] 5.1 创建WorkSessionViewModel
    - 集成PomodoroService和PostureDetectionService
    - 实现服务间的协调和状态同步
    - 添加会话开始、暂停、完成的统一控制
    - _需求: 2.8, 4.4_

  - [x] 5.2 构建主工作界面UI
    - 创建WorkSessionView整合所有组件
    - 实现摄像头预览、计时器、体态状态的布局
    - 添加界面间的导航和状态保持
    - _需求: 4.1, 4.2, 4.4_

- [x] 6. 实现时间轴图表和可视化
  - [x] 6.1 集成Swift Charts框架
    - 添加Swift Charts依赖到项目
    - 创建体态变化时间轴的数据模型
    - 实现基础图表组件的显示逻辑
    - _需求: 3.3_

  - [x] 6.2 开发交互式图表界面
    - 实现时间轴图表显示体态变化
    - 添加图表的交互功能和数据标签
    - 集成图表到统计界面中
    - _需求: 3.3, 4.5_

- [x] 7. 实现设置和偏好管理
  - [x] 7.1 创建设置数据管理
    - 实现AppSettings模型的持久化
    - 添加工作时长、休息时长的自定义设置
    - 创建提醒选项的开关控制
    - _需求: 1.2, 5.5_

  - [x] 7.2 构建设置界面UI
    - 创建SettingsView包含所有配置选项
    - 实现时长滑块和开关组件
    - 添加数据清除和重置功能
    - _需求: 1.2, 5.5_

- [ ] 8. 实现分享功能
  - [ ] 8.1 添加统计截图分享
    - 实现统计界面的截图生成功能
    - 集成iOS分享表单（UIActivityViewController）
    - 添加分享按钮到统计界面
    - _需求: 4.7_

- [ ] 9. 性能优化和错误处理
  - [ ] 9.1 实现性能监控和优化
    - 添加摄像头帧率控制（15fps限制）
    - 实现电池电量检测和处理频率调整
    - 优化内存使用和及时释放资源
    - _需求: 6.1, 6.2, 6.5, 6.6_

  - [ ] 9.2 完善错误处理机制
    - 实现HealthyCodeError错误类型定义
    - 添加摄像头权限被拒绝时的优雅降级
    - 创建Vision Framework错误的处理逻辑
    - _需求: 5.2, 5.3, 6.4_

- [ ] 10. 深色模式和主题支持
  - [ ] 10.1 实现颜色系统
    - 定义应用颜色主题（绿色、橙色、蓝色系统）
    - 实现深色模式的颜色适配
    - 更新所有UI组件支持主题切换
    - _需求: 4.6_

- [ ] 11. 单元测试和UI测试
  - [ ] 11.1 编写核心功能单元测试
    - 创建PostureDetectionTests测试体态分类逻辑
    - 实现PomodoroServiceTests测试计时器功能
    - 添加StatisticsServiceTests测试数据计算
    - _需求: 所有功能需求的验证_

  - [ ] 11.2 实现UI自动化测试
    - 创建HealthyCodeUITests测试主要用户流程
    - 测试工作会话的开始、暂停、重置流程
    - 验证界面导航和状态保持功能
    - _需求: 4.4, 用户体验验证_

- [ ] 12. 最终集成和优化
  - [ ] 12.1 完整应用流程测试
    - 测试完整的工作会话流程
    - 验证数据持久化和统计准确性
    - 确保所有UI交互的响应性能
    - _需求: 所有需求的端到端验证_

  - [ ] 12.2 真机测试和性能调优
    - 在不同iOS设备上测试兼容性
    - 优化摄像头处理性能和电池消耗
    - 验证Vision Framework在各设备上的表现
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_