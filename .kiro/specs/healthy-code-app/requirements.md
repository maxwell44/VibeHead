# 需求文档

## 项目介绍

HealthyCode（健康编码）是一款结合番茄工作法和实时体态检测的iOS应用，旨在帮助程序员、远程工作者和学生保持健康的工作习惯。该应用使用设备前置摄像头和Vision Framework监控用户在工作期间的体态，提供实时反馈和全面统计，促进更好的人体工程学实践。

## 需求

### 需求1：番茄时钟功能

**用户故事：** 作为一名程序员，我希望有一个可自定义的番茄时钟，以便我能够有效地安排工作时间。

#### 验收标准

1. 当用户打开应用时，系统应显示计时器设置界面，默认25分钟工作时间
2. 当用户自定义工作时长时，系统应保存偏好设置并在后续会话中使用
3. 当计时器运行时，系统应以大字体显示剩余时间，便于阅读
4. 当用户点击开始/暂停/重置控件时，系统应立即响应并进行相应的计时器状态更改
5. 当计时器归零时，系统应提供音频和触觉反馈通知
6. 当工作会话完成时，系统应自动转换到休息时间或会话总结

### 需求2：实时体态检测

**用户故事：** 作为注重健康的工作者，我希望有实时体态监控功能，以便在整个工作会话中保持正确的人体工程学姿势。

#### 验收标准

1. 当应用开始工作会话时，系统应激活前置摄像头进行体态监控
2. 当系统检测到用户面部时，应使用Vision Framework持续分析头部位置
3. 当用户保持正确姿势（头部直立，适当距离）时，系统应显示绿色的"优雅"状态
4. 当用户头部向下倾斜超过30度时，系统应检测到"低头"并显示橙色警告
5. 当用户头部左右倾斜超过15度时，系统应检测到"歪头"并显示橙色警告
6. 当用户坐得太靠近屏幕（面部边界框>帧的60%）时，系统应检测到"太近"并显示橙色警告
7. 当检测到不良姿势超过10秒时，系统应提供触觉反馈和音频提醒
8. 当体态检测激活时，系统应记录在每种姿势状态下花费的时间

### 需求3：统计和健康评分

**用户故事：** 作为专注于改善工作习惯的用户，我希望获得工作会话期间体态的详细统计信息，以便跟踪进度并识别需要改进的领域。

#### 验收标准

1. 当工作会话完成时，系统应显示统计摘要，显示在每种姿势下花费的时间
2. 当查看统计信息时，系统应显示优秀姿势与不良姿势时间的百分比分解
3. 当显示姿势数据时，系统应呈现显示整个会话期间姿势变化的时间轴图表
4. 当计算健康分数时，系统应使用公式：（优秀姿势时间/总会话时间）* 100
5. 当健康分数高于80%时，系统应显示带有绿色指示器的积极反馈
6. 当健康分数低于60%时，系统应显示带有橙色/红色指示器的改进建议
7. 当查看会话历史时，系统应使用UserDefaults存储和显示数据以实现持久化

### 需求4：用户界面和体验

**用户故事：** 作为移动应用用户，我希望有直观且视觉上吸引人的界面，以便在工作会话期间轻松导航和使用应用。

#### 验收标准

1. 当用户启动应用时，系统应显示简洁的启动屏幕，包含计时器设置和开始按钮
2. 当工作会话激活时，系统应显示圆形进度指示器、摄像头预览和当前姿势状态
3. 当显示姿势状态时，系统应使用一致的颜色编码：绿色表示优秀，橙色/红色表示警告，蓝色表示操作
4. 当用户在屏幕间导航时，系统应提供平滑过渡并保持会话状态
5. 当显示统计信息时，系统应为关键指标使用大字体，为姿势分解使用水平进度条
6. 当应用在不同光照条件下使用时，系统应支持浅色和深色模式外观
7. 当用户想要分享结果时，系统应为统计信息提供截图分享功能

### 需求5：隐私和权限

**用户故事：** 作为注重隐私的用户，我希望控制摄像头访问和数据存储，以便在保持隐私偏好的同时使用应用。

#### 验收标准

1. 当应用首次请求摄像头访问时，系统应显示清晰的权限对话框，解释体态检测目的
2. 当摄像头权限被拒绝时，系统应优雅地降级为仅计时器功能
3. 当处理摄像头数据时，系统应在本地执行所有分析，不传输视频数据
4. 当存储会话数据时，系统应仅保存统计摘要，不保存原始摄像头录像
5. 当用户想要清除数据时，系统应提供重置统计信息和偏好设置的选项

### 需求6：性能和兼容性

**用户故事：** 作为iOS用户，我希望应用在我的设备上流畅运行，以免干扰我的工作效率。

#### 验收标准

1. 当运行体态检测时，系统应保持应用响应性，UI更新时间少于2秒
2. 当处理摄像头帧时，系统应优化性能以防止设备过热
3. 当应用在iPhone X或更新设备上运行时，系统应利用完整的Vision Framework功能
4. 当在较旧设备上运行时，系统应优雅地回退到基本面部检测
5. 当多个应用运行时，系统应有效管理内存以防止崩溃
6. 当设备电量不足时，系统应提供减少摄像头处理频率的选项