# Implementation Plan

- [x] 1. 清理现有摄像头服务代码
  - 删除不需要的摄像头服务文件
  - 移除相关的导入和引用
  - 确保删除后项目能正常编译
  - _Requirements: 4.1_

- [x] 2. 在WorkSessionViewController中添加摄像头集成基础设施
  - 添加AVCaptureSession相关属性和队列
  - 从CameraTestViewController复制核心摄像头设置方法
  - 实现权限检查和请求逻辑
  - _Requirements: 1.1, 2.1, 2.2_

- [x] 3. 实现centerImageView的状态切换逻辑
  - 创建摄像头预览层设置方法
  - 实现静态图片到摄像头预览的切换动画
  - 实现摄像头预览到静态图片的切换动画
  - 确保圆形裁剪效果正确应用
  - _Requirements: 1.1, 1.4, 3.1, 3.2, 3.3_

- [x] 4. 集成会话状态管理
  - 修改primaryActionTapped方法以触发摄像头切换
  - 在会话开始时启动摄像头预览
  - 在会话结束或重置时停止摄像头预览
  - 确保与WorkSessionViewModel状态同步
  - _Requirements: 1.1, 1.4_

- [x] 5. 实现权限处理和错误恢复
  - 处理摄像头权限未授权的情况
  - 实现权限被拒绝时的用户引导
  - 添加摄像头初始化失败的错误处理
  - 实现摄像头会话中断的自动恢复
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 6. 优化视觉效果和用户体验
  - 确保摄像头预览的视频方向正确
  - 实现平滑的过渡动画效果
  - 优化圆形容器的视觉呈现
  - 添加加载状态指示器
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 7. 实现内存管理和生命周期控制
  - 在适当的生命周期方法中启动和停止摄像头
  - 实现内存警告时的资源释放
  - 确保没有内存泄漏和循环引用
  - 添加后台/前台切换时的摄像头管理
  - _Requirements: 4.3, 4.4_

- [x] 8. 测试和验证功能
  - 测试不同权限状态下的行为
  - 验证摄像头预览的正确显示
  - 测试会话状态切换时的摄像头行为
  - 验证错误处理和恢复机制
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4_